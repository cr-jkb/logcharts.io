(()=>{"use strict";function t(t){return!["Date","Time",""].includes(t)}function e(t){if(t){const e=t.split(":"),i=new Date;if(i.setHours(e[0]),i.setMinutes(e[1]),i.setSeconds(e[2]),!isNaN(i.getTime()))return i}}function i(t){if(t){if("No"==t)return 0;if("Yes"==t)return 1;if(!isNaN(t))return parseFloat(t)}}function n(t,e){let i=t.tooltipCircle.node().getBoundingClientRect(),n=15*(document.querySelectorAll(".selector-btn").length-1),o=i.bottom+20+n-document.querySelector(".domain").getBoundingClientRect().y+n,a=e?-21-o:-21,r=e?15-o:15;t.tooltip.node().setAttribute("y",a),t.tooltipBackground.node().setAttribute("y",a),t.tooltipBackgroundStroke.node().setAttribute("y",a),t.tooltipTime.node().setAttribute("dy",r)}function o(t,i){const n=d3.bisector((t=>e(t.Time))).center,o=i.invert(d3.pointer(event,this)[0]),a=n(t.chart.log,o,1),r=t.chart.log[a-1],l=t.chart.log[a];return l&&o-e(r.Time)>e(l.Time)-o?l:r}function a(t,e,n,o){let a=t+": "+i(e[t]),r=n.tooltipBackground.node().getBoundingClientRect().width+15,l=o?5-r:20;n.tooltipText.append("tspan").text(a).attr("id",t).attr("class","tooltip-value").attr("x",l).attr("dy",15)}function r(t){this.log=t.parsedLog,this.container=t.container;let e=this.container.clientHeight,i=this.container.clientWidth;this.margin={top:50,right:50,bottom:40,left:60},this.width=i-this.margin.left-this.margin.right,this.height=e-this.margin.top-this.margin.bottom-100,this.brushHeight=80}function l(t){if(null!=document.querySelector(".form-alert"))return void(document.querySelector(".form-alert").innerHTML=t);let e=document.createElement("h3");e.innerHTML=t,e.classList.add("form-alert"),document.querySelector(".third-step").appendChild(e)}function s(e){Papa.parse(e,{header:!0,encoding:"latin3",skipEmptyLines:!0,transformHeader:function(t){return t.replace("�","°")},complete:function(e){!function(t){if(t.includes("Time")&&t.includes("CPU [°C]"))return!0}(e.meta.fields)?l("Please send only logs from HWInfo!"):function(e){const i=document.querySelector(".third-step");i.querySelector("#form").remove();const n=document.createElement("h1");n.textContent="Please, select the default field",i.appendChild(n);const o=document.createElement("form"),a=document.createElement("select");for(let i of e.meta.fields)if(t(i)){let t=document.createElement("option");t.setAttribute("value",i),t.textContent=i,a.appendChild(t)}const r=document.createElement("button");r.textContent="Create chart",r.setAttribute("type","button"),r.addEventListener("click",(()=>{console.log(a.value)})),o.appendChild(a),o.appendChild(r),i.appendChild(o)}(e)}})}r.prototype.draw=function(){this.chartSVG=d3.select(this.container).append("svg").attr("class","chart-svg").attr("viewBox",`0 0 ${this.width} ${this.height}`),this.contextSVG=d3.select(this.container).append("svg").attr("class","context-svg").attr("viewBox",`0 0 ${this.width} 100`),this.clip=this.chartSVG.append("clipPath").attr("id","line_clip").append("rect").attr("transform",`translate(${this.margin.left}, 0)`).attr("width",this.width-2*this.margin.right-9).attr("height",this.height),this.addScales(),this.addAxes(),this.addGrid(),this.addMainLine(),this.addBrush(),this.addTooltip()},r.prototype.addScales=function(){this.xScale=d3.scaleTime().domain(d3.extent(this.log,(t=>e(t.Time)))).range([this.margin.left,this.width-this.margin.right]),this.yScale=d3.scaleLinear().domain(d3.extent(this.log,(t=>i(t["CPU [°C]"])))).nice().range([this.height-this.margin.bottom,this.margin.top]),this.yContextScale=d3.scaleLinear().domain(d3.extent(this.log,(t=>i(t["CPU [°C]"])))).range([this.brushHeight,this.margin.top])},r.prototype.addAxes=function(){this.xAxis=(t,e=1e3,i=this.xScale,n=this.height,o=this.margin.bottom)=>t.attr("transform",`translate(0, ${n-o})`).transition().duration(e).call(d3.axisBottom(i)).attr("class","x-axis"),this.chartSVG.append("g").call(this.xAxis),this.contextSVG.append("g").call(this.xAxis,1e3,this.xScale,100,20),this.yAxis=t=>t.attr("transform",`translate(${this.margin.left},0)`).transition().duration(1e3).call(d3.axisLeft(this.yScale)).call((t=>t.select(".domain").remove())).attr("class","y-axis"),this.chartSVG.append("g").call(this.yAxis)},r.prototype.addGrid=function(){this.chartSVG.append("g").attr("class","grid").attr("transform",`translate(${this.margin.left}, 0)`).call(d3.axisLeft(this.yScale).tickSize(-this.width+2*this.margin.right).tickFormat("")).call((t=>t.select(".domain").remove()))},r.prototype.addMainLine=function(){let t="id"+(new Date).valueOf();(function(t,e){let i=document.querySelector(".selector-btn-container"),n=!1;0==i.children.length&&(n=!0);let o=document.createElement("div");o.classList.add("selector-div"),o.style.borderBottom="3px solid "+e;let a=document.createElement("div");a.classList.add("color-picker"),o.appendChild(a);let r=document.createElement("input");r.setAttribute("type","radio"),r.setAttribute("id",t),r.setAttribute("name","selector-btn"),n&&(r.checked=!0),r.classList.add("selector-btn");let l=document.createElement("label");if(l.innerHTML="CPU [°C]",o.appendChild(r),o.appendChild(l),i.appendChild(o),Pickr.create({el:".color-picker",theme:"nano",default:e,defaultRepresentation:"HEX",swatches:["rgba(244, 67, 54, 1)","rgba(233, 30, 99, 1)","rgba(156, 39, 176, 1)","rgba(103, 58, 183, 1)","rgba(63, 81, 181, 1)","rgba(33, 150, 243, 1)","rgba(3, 169, 244, 1)","rgba(0, 188, 212, 1)","rgba(0, 150, 136, 1)","rgba(76, 175, 80, 1)","rgba(139, 195, 74, 1)","rgba(205, 220, 57, 1)","rgba(255, 235, 59, 1)","rgba(255, 193, 7, 1)"],components:{preview:!0,opacity:!0,hue:!0,interaction:{input:!0}}}).on("change",(function(e,i,n){document.querySelector("path#"+t).setAttribute("stroke",e.toHEXA()),o.style.borderBottom="3px solid "+e.toHEXA(),n.applyColor(n._lastColor)})),!n){let e,i=document.createElement("i");for(e of(i.classList.add("fas"),i.classList.add("fa-trash"),i.addEventListener("click",(function(){document.querySelector("path#"+t).remove(),o.remove()})),document.querySelectorAll(".pickr")))e.contains(i)||e.appendChild(i)}})(t,"#4E7BFF"),this.chartSVG.append("path").datum(this.log).attr("clip-path","url(#line_clip)").attr("fill","none").attr("stroke","#4E7BFF").attr("stroke-width",2).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("class","chart-line").attr("id",t).attr("d",d3.line().defined((t=>void 0!==i(t["CPU [°C]"]))).x((t=>this.xScale(e(t.Time)))).y((t=>this.yScale(i(t["CPU [°C]"]))))),this.contextSVG.append("path").datum(this.log).attr("fill","none").attr("stroke","#4E7BFF").attr("stroke-width",2).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("class","context-line").attr("d",d3.line().defined((t=>void 0!==i(t["CPU [°C]"]))).x((t=>this.xScale(e(t.Time)))).y((t=>this.yContextScale(i(t["CPU [°C]"])))))},r.prototype.addNewLine=function(t,n,o=this.xScale.copy(),a=this.yScale.copy()){this.brushedXScale?o=this.brushedXScale:o.domain(d3.extent(this.log,(t=>e(t.Time)))),a.domain(d3.extent(this.log,(t=>i(t["CPU [°C]"])))).nice(),this.chartSVG.insert("path",".tooltip").datum(this.log).attr("clip-path","url(#line_clip)").attr("fill","none").attr("stroke",n).attr("stroke-width",2).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("class","chart-line").attr("field","CPU [°C]").attr("id",t).attr("d",d3.line().defined((t=>void 0!==i(t["CPU [°C]"]))).x((t=>o(e(t.Time)))).y((t=>a(i(t["CPU [°C]"])))))},r.prototype.updateLineByField=function(t,n,o=this.xScale.copy(),a=this.yScale.copy()){this.brushedXScale?o=this.brushedXScale:o.domain(d3.extent(this.log,(t=>e(t.Time)))),a.domain(d3.extent(this.log,(e=>i(e[t])))).nice(),this.chartSVG.select("#"+n).transition().duration(1e3).attr("field",t).attr("d",d3.line().defined((e=>void 0!==i(e[t]))).x((t=>o(e(t.Time)))).y((e=>a(i(e[t])))))},r.prototype.updateMainLine=function(t){this.brushedXScale=void 0,this.selectedField=t,this.chartSVG.select(".chart-line")._groups[0][0].setAttribute("field",t),this.xScale.domain(d3.extent(this.log,(t=>e(t.Time)))),this.yScale.domain(d3.extent(this.log,(e=>i(e[t])))).nice(),this.yContextScale.domain(d3.extent(this.log,(e=>i(e[t])))),this.chartSVG.select(".x-axis").call(this.xAxis),this.chartSVG.select(".y-axis").transition().duration(1e3).call(this.yAxis),this.chartSVG.select(".grid").attr("transform",`translate(${this.margin.left}, 0)`).call(d3.axisLeft(this.yScale).tickSize(-this.width+2*this.margin.right).tickFormat("")).call((t=>t.select(".domain").remove())),1==this.chartSVG.select(".grid").selectAll(".tick").size()&&this.chartSVG.select(".grid").select(".tick").remove(),this.chartSVG.select(".chart-line").transition().duration(1e3).attr("d",d3.line().defined((e=>void 0!==i(e[t]))).x((t=>this.xScale(e(t.Time)))).y((e=>this.yScale(i(e[t]))))),this.contextSVG.select(".context-line").transition().duration(1e3).attr("d",d3.line().defined((e=>void 0!==i(e[t]))).x((t=>this.xScale(e(t.Time)))).y((e=>this.yContextScale(i(e[t]))))),this.contextSVG.select(".brush").transition().duration(1e3).call(this.brush.move,this.xScale.range()),this.chartSVG.select(".chart-line")._groups[0][0].setAttribute("domain",this.xScale.domain());let n,o=this.yScale.copy();for(n of document.querySelectorAll(".selector-btn"))t=n.parentNode.querySelector("label").innerHTML,o.domain(d3.extent(this.log,(e=>i(e[t])))).nice(),this.chartSVG.select("#"+n.id).transition().duration(1e3).attr("d",d3.line().defined((e=>void 0!==i(e[t]))).x((t=>this.xScale(e(t.Time)))).y((e=>o(i(e[t])))))},r.prototype.addBrush=function(){this.brush=d3.brushX().extent([[this.margin.left,0],[this.width-this.margin.right,this.brushHeight]]).on("brush",(t=>{if(t.sourceEvent){let e=t.selection;this.updateByBrush(e)}})),this.contextSVG.append("g").attr("class","brush").call(this.brush).call(this.brush.move,this.xScale.range())},r.prototype.updateByBrush=function(t,n=this.xScale.copy(),o=this.yScale.copy()){let a,r;for(r of(n.domain([n.invert(t[0]),n.invert(t[1])]),this.brushedXScale=n,this.chartSVG.select(".x-axis").call(this.xAxis,0,n),document.querySelectorAll(".selector-btn")))a=r.parentNode.querySelector("label").innerHTML,o.domain(d3.extent(this.log,(t=>i(t[a])))).nice(),this.chartSVG.select("#"+r.id).attr("d",d3.line().defined((t=>void 0!==i(t[a]))).x((t=>n(e(t.Time)))).y((t=>o(i(t[a])))))},r.prototype.addTooltip=function(){const t=this.chartSVG.append("g").attr("class","tooltip"),r=this.chartSVG.append("line").attr("class","tooltip-line").style("stroke","black").style("stroke-width",2).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",this.height-this.margin.bottom,this.margin.top),l=t.append("circle").attr("class","tooltip-circle").attr("r",5),s=t.append("rect").attr("class","tooltip-background").attr("width",100).attr("height",30).attr("x",15).attr("y",-21),c=t.append("rect").attr("class","tooltip-background-stroke").attr("width",100).attr("height",30).attr("x",15).attr("y",-21),d=t.append("text").attr("class","tooltip-value-container").attr("width",100).attr("height",30).attr("dx",15).attr("y",-15),h=d.append("tspan").attr("class","tooltip-time").attr("dy",15),u=this,p={tooltip:t,line:r,tooltipCircle:l,tooltipBackground:s,tooltipBackgroundStroke:c,tooltipText:d,tooltipTime:h,chart:u};this.chartSVG.on("touchmove mousemove",(function(l){t.selectAll(".tooltip-value").remove();const h=function(t){let e=document.body.clientWidth-document.querySelector(".chart-svg").getBoundingClientRect().width;return t.tooltipCircle.node().getBoundingClientRect().left+t.tooltipBackground.node().getBoundingClientRect().width-e>t.chart.width}(p);(function(t,e){let i=t.tooltipBackground.node().getBoundingClientRect().width+15,n=e?-i:15,o=e?5-i:20;t.tooltip.node().setAttribute("x",n),t.tooltipBackground.node().setAttribute("x",n),t.tooltipBackgroundStroke.node().setAttribute("x",n),t.tooltipTime.node().setAttribute("dx",o)})(p,!!h),function(t){let e=t.tooltipCircle.node().getBoundingClientRect(),i=15*(document.querySelectorAll(".selector-btn").length-1);return e.bottom+20+i>document.querySelector(".domain").getBoundingClientRect().y}(p)?n(p,!0):n(p,!1);const m=u.brushedXScale?u.brushedXScale:u.xScale;let g,f,y=o(p,m);for(g of document.querySelectorAll(".selector-btn"))f=g.parentNode.querySelector("label").innerHTML,a(f,y,p,h);const x=d.node().getBoundingClientRect(),S=x.height+10,b=x.width+10;s.node().setAttribute("height",S),s.node().setAttribute("width",b),c.node().setAttribute("height",S),c.node().setAttribute("width",b);const C=document.querySelector(".selector-div").lastChild.innerHTML,v=u.yScale;r.attr("transform","translate("+m(e(y.Time))+",0)"),t.attr("transform","translate("+m(e(y.Time))+","+v(i(y[C]))+")"),t.select(".tooltip-time").text(e(y.Time).toLocaleTimeString())})),this.chartSVG.on("mouseover",(function(){t.style("display",null),r.style("display",null)})),this.chartSVG.on("mouseout",(function(){t.style("display","none"),r.style("display","none")}))},document.getElementById("log_input").addEventListener("change",(function(){let t=document.getElementById("log_input").files[0];if(!function(t){if("text/csv"==t.type||"application/vnd.ms-excel"==t.type||!t.type)return!0}(t))return l("Please upload only CSV files!");s(t)})),document.getElementById("example").addEventListener("click",(async function(){(function(){let t=document.createElement("div");t.classList.add("loader-wrapper");let e=document.createElement("div");e.classList.add("loader"),t.appendChild(e),document.querySelector("main").appendChild(t)})(),s(await async function(){return await fetch("./assets/example.CSV").then((t=>t.text()))}())}))})();